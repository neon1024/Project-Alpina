define("ds2-tracking-enavigation-model",["jquery","ds2-tracking-base","ds2-tracking"],function(g,l,h){g.widget("digitals2.ds2TrackingEnavigationModel",l,{_create:function(){var b=this._super(),a=this;a.$modelNavigationComponent=g(".ds2-model-navigation");a.$modelMenu=a.$modelNavigationComponent.children(".ds2-model-menu");a.$modelNavigationComponent.on("navigationItemActiveChange",function(b){"click"!==b.eventType.toLowerCase()&&"swipe"!==b.eventType.toLowerCase()||a._trackModelNavigation(b)});return b},
_trackModelNavigation:function(b){var a=this._getTrackingEvent()||{},e=this._getTrackingOptions()||{},c=this._getActiveNavItemName(b),d=a.eventInfo?a.eventInfo.eventAction:"",f=window.location.href,k=this._isSeriesOrBodyRange(),m=b.eventType,p=a.eventInfo?a.eventInfo.element:"";e.name=a.eventInfo?a.eventInfo.track:"";a=this._populateClickEvent(b,e.name,f,c,k,m);a.eventInfo.eventPoints="";a.eventInfo.eventAction=d;a.eventInfo.element=p;e=this.bmwTrackOptionsBuilder.options().name(e.name||"").build();
this._parseDataFromEvent(a,e,b,!0)},_isSeriesOrBodyRange:function(){return 1===g(".pad1 li.active").data("id")?"Series":"Body type"},_getActiveNavItemName:function(b){return b.isSeriesOrBodyChanged?g(".pad1 li.active a").text().trim():b.activeSubNavItem.text().trim()},_getTrackingEvent:function(){return this.$modelMenu.data("trackingEvent")},_getTrackingOptions:function(){return this.$modelMenu.data("trackingOptions")}});return function(b){b.ds2TrackingEnavigationModel(h.getOptions("ds2-model-navigation"))}});
define("ds2-enavigation-model",["jquery","lodash","ds2-enavigation-model-accessibility","ds2-touch-detection","ds2-tracking-checker"],function(g,l,h,b,a){function e(){var c={resizeTimer:null,windowWidth:g(window).width(),rtimeOut:function(c,a){var d=Date.now,m=window.requestAnimationFrame,f=d(),b,e=function(){d()-f<a?b||m(e):c()};m(e);return{clear:function(){b=1}}},init:function(d,a){this.accessibility=new h(a);this.containers=d;this.$element=a;this.$modelCars=this.$element.find(".ds2-model-cars");
this.infiniteItems=!0;this.isTouch=b.any;this.clickevent=!1;this.$element.toggleClass("is-touch",this.isTouch);this.attachEvents();this.containers.each(function(d,a){a=g(a);c.initScrollBehavior(a.find("ul").first());c.scrollToItem(a.find(".active").first(),a.find("ul").first());0===d&&c.updateContent(a,"init")})},attachEvents:function(){var d=this;c.containers.each(function(a,b){var f=g(b),k=d.$element;k.css("min-height","0");f.on("click",".model-nav li",function(a){var b=g(this);a.preventDefault();
d.clickevent=!0;c.scrollToItem(b,b.closest("ul"));c.updateContent(f,a.type);-1===b.attr("data-series")?k.css("min-height","0"):k.removeAttr("style")});f.on("scrollToItem",function(c,a){d.clickevent||d.scrollToItem(a.$button.closest("li"),f.find("ul"),!1);d.clickevent=!1})});g(window).on("resize",function(){var a=g(window).width();c.windowWidth!==a&&(c.windowWidth=a,clearTimeout(c.resizeTimer),c.resizeTimer=setTimeout(function(){c.containers.each(function(a,d){a=g(d);c.initScrollBehavior(a);c.scrollToItem(a.find(".active").first(),
a.find("ul"))})},250))});this.$element.find(".model-nav-prev-button").on("click",function(a){var d=g(this),b=d.closest(".model-nav").find("li.active").prev().not(".clone");b.length&&(c.scrollToItem(b,b.closest("ul")),c.updateContent(d.closest(".model-nav-holder"),a.type))});this.$element.find(".model-nav-next-button").on("click",function(a){var d=g(this),b=d.closest(".model-nav").find("li.active");b=0!==b.length?b.next().not(".clone"):d.closest(".model-nav").find("li:first-child").not(".clone").addClass("active");
b.length&&(c.scrollToItem(b,b.closest("ul")),c.updateContent(d.closest(".model-nav-holder"),a.type))})},initScrollBehavior:function(a){a.hasClass("infinite")&&c.addInfiniteItems(a,!0,!0);if(980>c.windowWidth){var b;a.on("scroll",l.debounce(function(){b&&b.clear();b=c.rtimeOut(function(){if(!1===a.hasClass("disable-scroll")){var b=a.width()/2,d=a.offset().left,f=0,e=1E6,n=null;a.find("li").removeClass("active");a.find("li").each(function(){var a=g(this),c=a.offset().left,m=a.outerWidth();c=c+m/2-d;
if(0<=c)if(e>Math.abs(b-c))e=Math.abs(b-c),f=b-c,n=a;else return!1});a.addClass("disable-scroll");n.addClass("active");c.rtimeOut(function(){c.updateContent(a.closest(".model-nav-holder"),"swipe");var e=n.offset().left+n.outerWidth()/2-d;f=b-e;a.animate({scrollLeft:a.scrollLeft()+-f},50);c.rtimeOut(function(){a.removeClass("disable-scroll")},150);c.rtimeOut(function(){c.padPosition(a.closest(".model-nav-holder").find(".pad"),a)},50);0===a.scrollLeft()?c.rtimeOut(function(){a.addClass("disable-scroll");
c.addInfiniteItems(a,!0,!1);c.rtimeOut(function(){c.scrollToItem(n,a)},100)},50):a.scrollLeft()+a.outerWidth()>=a[0].scrollWidth&&c.rtimeOut(function(){a.addClass("disable-scroll");c.addInfiniteItems(a,!1,!0);c.rtimeOut(function(){c.scrollToItem(n,a)},100)},50)},200)}},100)},200))}},addInfiniteItems:function(a,c,b){if(this.infiniteItems){var d=this,f=[];a.find("li").not(".clone").each(function(){var a=g(this).clone();a.removeClass("active").addClass("clone");f.push(a)});for(var e=0;5>e;e++){if(c)for(var k=
f.length-1;0<=k;k--)a.prepend(f[k].clone());if(b)for(k=0;k<f.length;k++)a.append(f[k].clone())}this.$element.bind("removeInfiniteItems",function(){d.removeInfiniteItems()})}},removeInfiniteItems:function(){this.infiniteItems&&(this.$element.find("li.clone").each(function(){g(this).remove()}),this.infiniteItems=!1,this.$element.unbind("removeInfiniteItems"))},padPosition:function(a,c){c=c.find(".active").first();var b=a.parents().filter(function(){return"relative"===g(this).css("position")}).first();
c.offset()&&(b=c.offset().left-b.offset().left,a.css({left:b,width:c.outerWidth()}))},scrollToItem:function(a,b,e){b.addClass("disable-scroll");if(void 0===e||!0===e)b.find("li").removeClass("active"),a.addClass("active");c.rtimeOut(function(){var d=b.offset().left,e=b.width()/2,f=a.offset()?a.offset().left:0,k=a.outerWidth();d=e-(f+k/2-d);b.animate({scrollLeft:b.scrollLeft()+-d},150);c.rtimeOut(function(){b.removeClass("disable-scroll");c.rtimeOut(function(){c.padPosition(b.closest(".model-nav-holder").find(".pad"),
b);c.showHideNextPrevButtons(b.closest(".model-nav-holder"))},25)},250)},100)},showHideCars:function(a,b,e){var d=this.$element.find(".ds2-model-car"),f=a.data("series")||null,k=a.data("body-type")||null,h=d.filter(function(){var a=g(this);return a.data("car-series")===f||a.data("car-body-type")===k}).length,l=[];d.each(function(a,b){var d=g(this);(d.data("car-series")===f||d.data("car-body-type")===k)&&0>l.indexOf(d.data("car-model-name"))?(l.push(d.data("car-model-name")),d.hasClass("hide")&&c.rtimeOut(function(){d.removeClass("hide");
c.rtimeOut(function(){d.find(".ds2-model-card").removeClass("car-hidden").addClass("car-visible")},50)},400)):!1===d.hasClass("hide")&&(d.find(".ds2-model-card").removeClass("car-visible").addClass("car-hidden"),c.rtimeOut(function(){d.addClass("hide")},400))});h?c.adaptCarsWrapperHeight(!0):c.adaptCarsWrapperHeight(!1);this.$element.find(".ds2-model-menu").trigger({type:"navigationItemActiveChange",eventType:b,activeSubNavItem:a,isSeriesOrBodyChanged:e})},updateContent:function(a,b){var d=this.$element.find(".pad2"),
e=this.$element.find(".pad3");if(a.hasClass("pad1")){var f=a.find("li.active").first().data("id");1===f?(d.show(),e.hide(),f=d.find("li.active").first(),c.showHideCars(f,b,!0),c.scrollToItem(f,d.find("ul")),setTimeout(function(){c.padPosition(d.find(".pad"),d.find("ul"))},20)):2===f&&(e.show(),d.hide(),f=e.find("li.active").first(),c.showHideCars(f,b,!0),c.scrollToItem(f,e.find("ul")),c.rtimeOut(function(){c.padPosition(e.find(".pad"),e.find("ul"))},20))}a.hasClass("pad2")&&(f=a.find("li.active").first(),
c.showHideCars(f,b,!1));a.hasClass("pad3")&&(f=a.find("li.active").first(),c.showHideCars(f,b,!1));this.accessibility.updateSelectedTabs(a)},showHideNextPrevButtons:function(a){var b=a.find(".model-nav-prev-button"),c=a.find(".model-nav-next-button"),d=a.find("ul li").not(".clone").last();"rtl"===g("html").attr("dir")&&(d=b,b=c,c=d,d=a.find("ul li").not(".clone").first());0===a.find("ul").scrollLeft()?b.hide():b.show();d.length&&(b=d.offset().left+d.outerWidth()-d.closest("ul").offset().left,a.find("ul").width()>=
b?c.hide():c.show())},adaptCarsWrapperHeight:function(a){a?this.$modelCars.css("min-height",this.$modelCars.data("min-height")):this.$modelCars.css("min-height","auto")}};return c}return function(b){var c=g(b);e().init(c.find(".model-nav-holder"),c);a.isDigitals2TrackingAvailable()&&require(["ds2-tracking-enavigation-model"],function(a){a(c)})}});
define("ds2-enavigation-model-accessibility",["jquery","ds2-accessibility"],function(g,l){function h(b){this.accessibility=new l(b);this.keyCodes=this.accessibility.keyCodes;this.$element=g(b);this.selectors={navHolders:".model-nav-holder",firstLevel:".pad1",secondLevelModel:".pad2",secondLevelBody:".pad3",thirdLevel:".ds2-model-cars",activeTab:"li.active",roleTab:'[role\x3d"tab"]',button:"button",clone:".clone",modelCard:".ds2-model-car",activeCard:".ds2-model-car:not(.hide)",modelCardTitle:".ds2-model-card--title",
linkListItem:".ds2-linklist--item",link:'a:not(.close-button):not([tabindex\x3d"-1"])',tooltip:".ds2-tooltip",uxn:".ds2-flyout-all-models"};this.selectors.activeTabButton=this.selectors.activeTab+" "+this.selectors.button;this.selectors.activeCardLink=this.selectors.activeCard+" "+this.selectors.link;this.selectors.modelCardLink=this.selectors.modelCard+" "+this.selectors.link;this.selectors.modelCardTooltip=this.selectors.modelCard+" "+this.selectors.tooltip;this.$navHolders=this.$element.find(this.selectors.navHolders);
this.$navTabs=this.$navHolders.find(this.selectors.button);this.$links=this.$element.find(this.selectors.modelCardLink);this.$tooltips=this.$element.find(this.selectors.modelCardTooltip);this.$thirdLevel=this.$element.find(this.selectors.thirdLevel);this.isEmbedded=0===this.$navHolders.filter(this.selectors.firstLevel).length;this.isEmbeddedInUXN=0!==this.$element.parents(this.selectors.uxn).length;this.addKeyboardSupportForNavigation(this.keyCodes);this.addKeyboardSupportForModelCards(this.keyCodes);
this.addScreenReaderSupportForModelCards()}h.prototype.addKeyboardSupportForNavigation=function(b){var a=this;this.$navHolders.each(function(e){var c=g(this),d=c.find(a.selectors.roleTab),f=!1;a.accessibility.addKeyListener("up",{element:c,keyCodes:[a.accessibility.keyCodes.TAB],fn:function(){a.$element.trigger("removeInfiniteItems")}});a.isEmbeddedInUXN?a.makeTabsFocusableAndNavigationUnfocusable():(a.accessibility.addKeyListener("down",{element:c,keyCodes:[b.ARROW_LEFT,b.ARROW_RIGHT],fn:function(d){var e=
c.find(a.selectors.activeTab);d=(d.key===b.ARROW_LEFT?e.prevAll():e.nextAll()).not(a.selectors.clone).first().find(a.selectors.button);0!==d.length&&(d.click(),a.accessibility.focusElement(c),a.makeNavigationFocusableAndTabsUnfocusable())}}),a.accessibility.addKeyListener("up",{element:c,keyCodes:[b.ENTER],fn:function(){document.activeElement===c[0]&&(a.makeTabsFocusableAndNavigationUnfocusable(),a.accessibility.focusElement(c.find(a.selectors.activeTabButton)))}}),a.accessibility.addKeyListener("up",
{element:c,keyCodes:[b.ESC],fn:function(){a.resetKeyboardNavigation()}}));d.each(function(k){var h=g(this);h.on("focus",function(){f||(a.makeTabsFocusableAndNavigationUnfocusable(),f=!0);c.hasClass("pad1")||setTimeout(function(){c.trigger("scrollToItem",{$button:h})},50)});a.accessibility.addKeyListener("up",{element:h,keyCodes:[b.ENTER],fn:function(){a.deactivateSiblingTabsAndFocusNextLevelNavigation(d,0===e,k);f=!1}});a.isEmbeddedInUXN||a.accessibility.addKeyListener("up",{element:h,keyCodes:[b.ESC],
fn:function(){a.makeNavigationFocusableAndTabsUnfocusable();a.accessibility.focusElement(c)}})})})};h.prototype.addKeyboardSupportForModelCards=function(b){var a=this;this.$links.each(function(){var e=g(this),c=e.closest(a.selectors.modelCard);a.accessibility.highlightElementWhenChildInFocus(e,c);a.accessibility.addKeyListener("down",{element:e,keyCodes:[b.ARROW_LEFT,b.ARROW_RIGHT,b.ARROW_UP,b.ARROW_DOWN],fn:function(b){var d=a.findLinkToFocusInModelCards(b.key,e,c);b.preventDefault();a.accessibility.focusElement(d)}})});
this.$tooltips.each(function(){var b=g(this),c=b.closest(a.selectors.modelCard);a.accessibility.highlightElementWhenChildInFocus(b,c)});a.isEmbeddedInUXN||this.accessibility.addKeyListener("up",{element:this.$thirdLevel,keyCodes:[b.ESC],fn:function(){a.resetKeyboardNavigation()}})};h.prototype.makeNavigationFocusableAndTabsUnfocusable=function(){var b=this;this.$navHolders.each(function(a,e){b.accessibility.makeElementActive(e)});this.$navTabs.each(function(a,e){b.accessibility.makeElementInactive(e)})};
h.prototype.makeTabsFocusableAndNavigationUnfocusable=function(){var b=this;this.$navTabs.each(function(a,e){b.accessibility.makeElementActive(e)});this.$navHolders.each(function(a,e){b.accessibility.makeElementInactive(e)})};h.prototype.deactivateSiblingTabsAndFocusNextLevelNavigation=function(b,a,e){var c=this;b.each(function(a,b){a!==e&&c.accessibility.makeElementInactive(b)});a&&!this.isEmbedded?this.accessibility.focusElement(this.$navHolders.filter(0===e?this.selectors.secondLevelModel:this.selectors.secondLevelBody).find(this.selectors.activeTabButton)):
setTimeout(function(){c.accessibility.focusFirstFocusableChild(c.$thirdLevel.find(c.selectors.activeCard).first())},500)};h.prototype.findLinkToFocusInModelCards=function(b,a,e){if(b===this.keyCodes.ARROW_LEFT)var c=e.prevAll(this.selectors.activeCard).find(this.selectors.link).last().closest(this.selectors.modelCard).find(this.selectors.link).first();else b===this.keyCodes.ARROW_RIGHT?c=e.nextAll(this.selectors.activeCard).find(this.selectors.link).first():b===this.keyCodes.ARROW_UP?(c=a.closest(this.selectors.linkListItem).prev().find(this.selectors.link),
0===c.length&&(c=e.prevAll(this.selectors.activeCard).find(this.selectors.link).last())):b===this.keyCodes.ARROW_DOWN&&(c=a.closest(this.selectors.linkListItem).next().find(this.selectors.link),0===c.length&&(c=e.nextAll(this.selectors.activeCard).find(this.selectors.link).first()));return c};h.prototype.resetKeyboardNavigation=function(){var b=this.$navHolders.filter(this.selectors.firstLevel),a=this.$navHolders.filter(this.selectors.secondLevelModel);0!==b.length&&b.find(this.selectors.button).first().click();
a.find(this.selectors.button).first().click();this.makeNavigationFocusableAndTabsUnfocusable();this.accessibility.focusElement(a)};h.prototype.updateSelectedTabs=function(b){var a=this;b.find(this.selectors.button).each(function(){a.accessibility.setAriaStatus(this,!1)});b.find(a.selectors.activeTabButton).each(function(){a.accessibility.setAriaStatus(this,!0)})};h.prototype.addScreenReaderSupportForModelCards=function(){var b=this;this.$thirdLevel.find(this.selectors.modelCardTitle).each(function(){b.accessibility.setAriaHeading(this)})};
return h});