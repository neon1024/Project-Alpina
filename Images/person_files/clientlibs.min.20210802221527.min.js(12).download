define("ds2-mood-preconfiguration",["ds2-main","lazyload","swiper","ds2-accessibility","ds2-touch-detection","business/commons/TrackingAdapter"],(function(t,e,n,i,o,r){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e,n){var i,o;i=[e,n(11)],void 0===(o=function(t,e){"use strict";var n;function i(t,e){let n;do{n=Object.getOwnPropertyDescriptor(t,e)}while(!n&&(t=Object.getPrototypeOf(t)));return n}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,n,o){let r=Array.isArray(n)?n:(0,e.default)(n);for(let e=0;e<r.length;e++){let n=r[e];const a=i(t,n);if(e===r.length-1)return a&&a.hasOwnProperty("value")?a.value:a&&a.hasOwnProperty("get")?a.get.apply(t):o;if(!a)return o;t=t[n]}return o},e=(n=e)&&n.__esModule?n:{default:n}}.apply(e,i))||(t.exports=o)},function(t,e,n){var i,o;i=[e,n(13)],void 0===(o=function(t,e){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.search;const n=(0,e.default)(t);if(n.wcmmode&&n.wcmmode.length>0)return n.wcmmode[0];if(!window.CQ)return"";if(!window.CQ.WCM)return"";return window.CQ.WCM.getMode()},e=(n=e)&&n.__esModule?n:{default:n}}.apply(e,i))||(t.exports=o)},function(t,e,n){var i,o;i=[e,n(3),n(4),n(5),n(6),n(7),n(8)],void 0===(o=function(t,e,n,i,o,r,a){"use strict";function c(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n=c(n),i=c(i),o=c(o),r=c(r),a=c(a);const s=new business.commons.logger("bmwweb-fc","MoodPreconfiguration");function l(t,e){const{conUrl:n}=window.moodPreconfiguration,{linkData:i}=t,o=n.split("configure/")[0];return e&&"external"===i.ctaLinkSelect?i.externalUrl:e&&"custom"===i.ctaLinkSelect?i.cpLinkListUrl:e||"external"!==i.ctaLink2Select?e||"custom"!==i.ctaLink2Select?"".concat(o,"summary/").concat(i.mrCode,"/").concat(i.modelCode,"/").concat(i.fabric,",").concat(i.paint,",").concat(i.saCodes,"?preconfiguredModel=true"):i.cpLink2ListUrl:i.externalUrl2}function d(t,e){const n=function(t){const e=t.target.closest(".ds2-mood-preconfiguration__wrapper").querySelectorAll(".ds2-mood-preconfiguration-item");let n;for(let i=0,o=e.length;i<o;i+=1)e[i].querySelector(".ds2-mood-preconfiguration-item__container")===t.target.closest(".ds2-mood-preconfiguration-item__container")&&(n=t.target.closest(".ds2-mood-preconfiguration-item__container").getAttribute("data-item-path"));return n}(t),i=window.moodPreconfiguration.items[n];if(t.target&&(t.target.closest(".ds2-mood-preconfiguration-item__content-container")||t.target.closest(".ds2-mood-preconfiguration-item__button--list"))&&"SF-CALCULATION-WIDGET"!==t.target.tagName)if(t.preventDefault(),window.consentcontroller&&window.consentcontroller.api&&function(t){window.consentcontroller.api.setPersistence("preconfiguredModelData",JSON.stringify(t.marketingData))}(i),t.target.getAttribute("data-tracking-linkid")&&t.target.getAttribute("data-tracking-linkid").includes("secondary-cta")||t.target.parentElement.getAttribute("data-tracking-linkid")&&t.target.parentElement.getAttribute("data-tracking-linkid").includes("secondary-cta")){const t=""!==i.linkData.external2Url&&"new"===i.linkData.link2Target;if(e.moodPreconfigurationTracking.dispatchClickEvent(n,t),"external"===i.linkData.ctaLink2Select&&""!==i.linkData.externalUrl2)return void("new"===i.linkData.link2Target?window.open(i.linkData.externalUrl2,"_blank"):window.location.href=i.linkData.externalUrl2);if("custom"===i.linkData.ctaLink2Select&&""!==i.linkData.cpLink2ListUrl)return void(window.location.href=i.linkData.cpLink2ListUrl);window.location.href=l(i,!1)}else{const t=""!==i.linkData.externalUrl&&"new"===i.linkData.linkTarget;if(e.moodPreconfigurationTracking.dispatchClickEvent(n,t),"external"===i.linkData.ctaLinkSelect&&""!==i.linkData.externalUrl)return void("new"===i.linkData.linkTarget?window.open(i.linkData.externalUrl,"_blank"):window.location.href=i.linkData.externalUrl);if("custom"===i.linkData.ctaLinkSelect&&""!==i.linkData.cpLinkListUrl)return void(window.location.href=i.linkData.cpLinkListUrl);window.location.href=l(i,!0)}}function u(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)>980}function f(){let t=0;!1===u()&&(t=85);return r.default.any&&u()?10:t}function p(t){let e=0;return t.forEach(t=>{t.offsetHeight>e&&(e=t.offsetHeight)}),e}function g(t,e){const n=function(t){const e=[...t.querySelectorAll(".ds2-mood-preconfiguration-item__header")].map(t=>t.offsetHeight);return Math.max(...e)}(t);[...e].forEach(t=>Object.assign(t.style,{"margin-top":"".concat(n-50,"px")}))}function h(t){const e=t.querySelectorAll(".ds2-mood-preconfiguration-item__price-list-layer"),n=t.querySelectorAll(".ds2-mood-preconfiguration-item__hover-content"),i=f();e.forEach(t=>{t.removeAttribute("style")});const o=p(e);!function(t,e){t.forEach(t=>{t.setAttribute("style","height: ".concat(e,"px"))})}(e,o+i),function(t,e){t.forEach(t=>{t.setAttribute("style","top: ".concat(e,"px"))})}(n,o+2+i),g(t,n)}function m(t){const e=t.querySelectorAll(".ds2-mood-preconfiguration-item__content-container"),n=t.querySelector(".ds2-mood-preconfiguration__pagination");n.classList.add("ds2-mood-preconfiguration__pagination--fade-in");const i=p(e);n.setAttribute("style","top: ".concat(i-55,"px"))}function y(){h(this),m(this)}function b(t,e){const n=t.querySelectorAll(".ds2-mood-preconfiguration-item__content-container, .ds2-mood-preconfiguration-item__button");for(let t=0,i=n.length;t<i;t+=1)n[t].setAttribute("data-tracking-linkid","".concat(window.moodPreconfiguration.items[e].trackingData.productName," mood pre-configuration details clicked"))}class w{constructor(t){this.el=t,this.items=this.el.querySelectorAll(".ds2-mood-preconfiguration-item"),this.lazyload=new n.default({container:this.el}),function(t){const e=t.querySelectorAll(".ds2-mood-preconfiguration-item__price");let n=0;for(let t=0,i=e.length;t<i;t+=1){""!==e[t].innerText&&(n+=1)}if(n<1)for(let t=0,n=e.length;t<n;t+=1)e[t].classList.add("ds2-mood-preconfiguration-item__price--hide")}(this.el),this.relatedComponentData=JSON.parse(this.el.getAttribute("data-tracking-component")),function(t){const e=t.querySelectorAll(".ds2-mood-preconfiguration-item");for(let t=0,n=e.length;t<n;t+=1){const n=e[t],i=n.querySelector(".ds2-mood-preconfiguration-item__container").getAttribute("data-item-path"),o=n.getAttribute("data-modelrange-vehicle");n.setAttribute("data-tracking-regionid","mood pre-configuration > option ".concat(t+1,":").concat(o)),b(n,i)}}(this.el),this.moodPreconfigurationTracking=new a.default(this.relatedComponentData),this.accessibility=new o.default(t),this.preventFocusOnButton(),this.addItemIndex(),this.addKeyboardListener(),setTimeout(()=>{this.initSwiper(),this.el.classList.add("ds2-mood-preconfiguration--fade-in")},100),this.el.addEventListener("click",t=>{d(t,this)},{capture:!0}),setTimeout(()=>{h(this.el),m(this.el)},300),this.addTouchDetection(),new ResizeObserver(y.bind(this.el)).observe(this.el),this.initializeFinanceListener()}initializeFinanceListener(){if(this.showFinance="true"===this.el.getAttribute("data-show-finance"),this.showFinance)if("loading"!==document.readyState)this.initFinance();else{const t=()=>{this.initFinance()};window.addEventListener("load",t),window.addEventListener("DOMContentLoaded",()=>{window.removeEventListener("load",t),t()})}}addTouchDetection(){r.default.any&&this.el.classList.add("is-touch")}preventFocusOnButton(){this.items.forEach(t=>{const e=t.querySelector(".ds2-mood-preconfiguration-item__button-link");e&&e.setAttribute("tabindex","-1");const n=t.querySelector(".ds2-mood-preconfiguration-item__button--ghost");n&&n.setAttribute("tabindex","-1")})}addItemIndex(){this.items.forEach((t,e)=>{t.setAttribute("data-mood-preconfiguration-item-index",e)})}addKeyboardListener(){this.items.forEach(t=>{const e=t.querySelector(".ds2-mood-preconfiguration-item__button-link");this.accessibility.addKeyListener("up",{element:t,keyCodes:[this.accessibility.keyCodes.ENTER],fn:()=>{e.click()}}),t.addEventListener("keydown",this.keyDownHandler.bind(this))})}initSwiper(){const t=this.el.querySelector(".swiper-pagination").dataset.ariaLabelPagination;this.swiper=new i.default(this.el.querySelector(".swiper-container"),{speed:400,slidesPerView:3,spaceBetween:15,centeredSlides:!0,keyboardControl:!0,preloadImages:!1,breakpoints:{520:{slidesPerView:1,spaceBetween:5},980:{slidesPerView:2,spaceBetween:15,centeredSlides:!1}},pagination:{el:".swiper-pagination",type:"bullets",clickable:!0},a11y:{paginationBulletMessage:t}})}keyDownHandler(t){const e=t.which||t.keyCode;if(!u()&&this.accessibility.keyCodes.TAB===e){const e=w.getItemIndex(t.target);if(t.shiftKey){if(0===e)return;this.swiper.slideTo(e-1),setTimeout(()=>{this.items[e-1].focus()},400)}else{if(2===e)return;this.swiper.slideTo(e+1),setTimeout(()=>{this.items[e+1].focus()},400)}t.preventDefault()}}static getItemIndex(t){const e=t.getAttribute("data-mood-preconfiguration-item-index");return parseInt(e,10)}initFinance(){this.financeBundleUrl=this.el.getAttribute("data-finance-bundle-url"),this.financeHostUrl=this.el.getAttribute("data-finance-host-url"),this.currency=this.el.getAttribute("data-currency"),this.locale=document.querySelector("html").getAttribute("lang"),this.country=this.el.getAttribute("data-country");const t=this.el.querySelector(".ds2-mood-preconfiguration-item__finance-container");this.brand=null!=t?t.getAttribute("data-brand"):"bmwCar",this.language=this.locale.substring(0,this.locale.indexOf("-")),w.loadBundle(this.financeBundleUrl).then(()=>{this.province=window.consentcontroller&&window.consentcontroller.api?window.consentcontroller.api.getPersistence("prov_consentCookie"):null,this.financeConfig={tenant:{channel:"PRECON",brand:this.brand,country:this.country,province:this.province,language:this.language,priceTree:"DEFAULT",gfsPolicy:"none"},environment:{locale:this.locale,currency:this.currency,SF_HOST:this.financeHostUrl,modalContainer:this.el.querySelector(".sf-disclaimer")}};const t={channels:"PRECON",brands:this.brand,countries:this.country,provinces:this.province,languages:this.language,priceTree:"DEFAULT",gfsPolicy:"none"};document.addEventListener("SFWidgetInitEvent",()=>{s.debug("Finance Calculator widget ready"),h(this.el),m(this.el)}),document.addEventListener("SFDataErrorEvent",t=>{s.error("Error event reported by finance calculator component",t),this.financeError()}),document.addEventListener("SFErrorEvent",t=>{s.error("Error event reported by finance calculator component",t),this.financeError()}),this.el.querySelectorAll(".ds2-mood-preconfiguration-item__finance-container").forEach(e=>{const n=e.querySelector("sf-calculation-widget");if(n&&"object"==typeof n.configuration){const i=(new Date).toISOString().substring(0,10),o={models:e.getAttribute("data-model-code"),modelRange:e.getAttribute("data-model-range"),gearboxCode:null,equipments:w.getEquipments(e),modelName:e.getAttribute("data-model-name"),orderDate:i,effectDate:i};n.configuration={tenantParams:t,configurationParams:o,environment:this.financeConfig.environment}}else s.error("Could not initialize SF calculation widget"),this.financeError()})}).catch(t=>{s.error("Error during finance calculator bootstrap",t),this.financeError()})}static loadBundle(t){return new Promise((e,n)=>{const i=document.createElement("script");i.src=t,i.type="module",i.onError=n,i.async=!0,i.onload=e,i.addEventListener("error",n),i.addEventListener("load",e),document.head.appendChild(i)})}financeError(){s.debug("Finance Error",this.financeConfig)}static getEquipments(t){const e=t.getAttribute("data-fabric"),n=t.getAttribute("data-paint"),i=t.getAttribute("data-sa-codes"),o=[];return w.pushIfNotNull(e,o),w.pushIfNotNull(n,o),w.pushIfNotNull(i,o),o.join(",").split(",")}static pushIfNotNull(t,e){t&&e.push(t)}}var k=w;t.default=k}.apply(e,i))||(t.exports=o)},function(e,n){e.exports=t},function(t,n){t.exports=e},function(t,e){t.exports=n},function(t,e){t.exports=i},function(t,e){t.exports=o},function(t,e,n){var i,o;i=[e,n(9),n(12),n(15),n(0)],void 0===(o=function(t,e,n,i,o){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,e=r(e),n=r(n),i=r(i),o=r(o);class l{constructor(t){if(l._instance)return l._instance;l._instance=this,this.relatedComponentData=t,this.trackingApi=new e.default,this.trackingApi.isInitialized().then(t=>{t&&this.initComponentTracking()})}initComponentTracking(){this.trackingApi.initComponentTracking(this.relatedComponentData)}getConfigLink(t){const{conUrl:e}=window.moodPreconfiguration,{trackingData:n}=t;return"".concat(e).concat(n.internalCode,"/").concat(n.modelCode,"/").concat(n.fabric,",").concat(n.paint,",").concat(n.saCodes,"?preconfiguredModel=true")}getCosyBrand(t){return"wbbi"===t.trackingData.manufacturer.toLowerCase()?"BMWI":"BMW"}getProductObj(t){return{productInfo:{productID:"".concat(this.getCosyBrand(t),"-").concat(t.trackingData.internalCode),productName:t.trackingData.productName,manufacturer:this.getCosyBrand(t)},category:{primaryCategory:"new car",subCategory1:"bto",productType:"vehicle"},attributes:{linkedProduct:{productInfo:{productID:"na"}},internalCode:t.trackingData.internalCode,modelCode:t.trackingData.modelCode,productionYear:"na",series:"na",fuelType:"na",gearing:"na",engine:"na",color:t.trackingData.paint,vehicleSelection:"na",configID:"na",configLink:this.getConfigLink(t)}}}dispatchClickEvent(t,e){const n=window.moodPreconfiguration.items[t],i=this.getProductObj(n);this.trackingApi.initProductTracking(i);const o={eventInfo:{eventName:"interaction",eventAction:e?"external click":"internal click",eventPoints:"na",type:"ux",effect:"nsc > all mood pre-configuration details clicked",cause:"default",target:"na",element:"na"},attributes:{requestedURL:"na",errorCode:"na",linkedComponent:{componentInfo:this.relatedComponentData&&this.relatedComponentData.componentInfo.componentID},linkedPage:{pageInfo:{pageID:window.location.pathname}},linkedProduct:{productInfo:{productID:"".concat(this.getCosyBrand(n),"-").concat(n.trackingData.internalCode)}}}};this.dispatch("mood_pre_configuration_interaction",o,t)}dispatch(t,e,n){let i=parseInt(n.substring(n.length-1));const o={category:{primaryCategory:"mood pre-configuration",subCategory1:"option ".concat(i+1)}},r=this.trackingApi.createEvent(c(c({},o),e));this.trackingApi.dispatchEvent(r,t)}}((0,n.default)()||(0,i.default)())&&Object.getOwnPropertyNames(l.prototype).forEach((function(t){l.prototype[t]=function(){}}));var d=l;t.default=d}.apply(e,i))||(t.exports=o)},function(t,e,n){var i,o;i=[e,n(10),n(0)],void 0===(o=function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,e=i(e),n=i(n);class o{constructor(){this.isTrackingAllowed=!1}isInitialized(){return new Promise((t,n)=>{o.isConsentAccepted().then(()=>{e.default&&e.default.isInitialized()&&(this.isTrackingAllowed=!0,t(!0))},()=>{n()})})}static isConsentAccepted(){return new Promise((t,e)=>{(0,n.default)(window,"consentcontroller.api.isInitialized")?!1===window.consentcontroller.api.isInitialized()?window.consentcontroller.api.isRegulationAccepted()?t():e():window.consentcontroller.api.registerOnInitialized(()=>{window.consentcontroller.api.isRegulationAccepted()?t():e()}):e()})}createEvent(t){if(!this.isTrackingAllowed)return{};const e=o.newEvent(t).build();return delete e.attributes.relatedPageName,delete e.attributes.relatedPageCategory,delete e.attributes.relatedComponent,delete e.category.mmdr,delete e.category.eventType,e}dispatchEvent(t,n){if(!this.isTrackingAllowed)return;const i=e.default.buildOptions(n);e.default.trackEvent(t,{},i)}static newEvent(t){return e.default.getEventBuilder().newEvent(t)}initComponentTracking(t,n){this.isTrackingAllowed&&e.default.initComponentTracking(t,n)}initProductTracking(t,n){this.isTrackingAllowed&&e.default.api.initProductTracking(t,e.default.api.getCurrentPageIndex(),n)}}var r=o;t.default=r}.apply(e,i))||(t.exports=o)},function(t,e){t.exports=r},function(t,e,n){var i;void 0===(i=function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){let e=t;if(Array.isArray(e))return e;if("number"==typeof e)return[e];e=String(e);const n=[];return e.replace(/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(\.|\[\])(?:\4|$))/g,(t,e,i,o)=>{const r=void 0!==e?Number(e):t;return n.push(i?o:r),n[n.length-1]}),n}}.apply(e,[e]))||(t.exports=i)},function(t,e,n){var i,o;i=[e,n(1)],void 0===(o=function(t,e){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){const t=(0,e.default)();return"string"!=typeof t||"edit"===t},e=(n=e)&&n.__esModule?n:{default:n}}.apply(e,i))||(t.exports=o)},function(t,e,n){var i,o;i=[e,n(14)],void 0===(o=function(t,e){"use strict";var n;function i(t,e,n){const i=Array.isArray(n)?n.join(","):n,o=t;e in o?o[e].push(i):o[e]=[i]}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){const n={};let o=t;"?"===o.charAt(0)&&(o=o.slice(1));for(let t=o.split("&"),r=0,a=t.length;r<a;r+=1){const o=t[r],a=o.indexOf("=");a>-1?i(n,(0,e.default)(o.slice(0,a)),(0,e.default)(o.slice(a+1))):o.length&&i(n,(0,e.default)(o),!0)}return n},e=(n=e)&&n.__esModule?n:{default:n}}.apply(e,i))||(t.exports=o)},function(t,e,n){var i;void 0===(i=function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){return decodeURIComponent(t.replace(e," "))};const e=/\+/g}.apply(e,[e]))||(t.exports=i)},function(t,e,n){var i,o;i=[e,n(1)],void 0===(o=function(t,e){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return"design"===(0,e.default)()},e=(n=e)&&n.__esModule?n:{default:n}}.apply(e,i))||(t.exports=o)}])}));